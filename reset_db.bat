@echo off
echo ==========================================================
echo           СКРИПТ СКИДАННЯ ТА НАЛАШТУВАННЯ БАЗИ ДАНИХ
echo ==========================================================
echo.
echo УВАГА: Цей скрипт видалить існуючу базу даних (db.sqlite3)
echo та всі файли міграцій для додатку 'shop'.
echo Всі дані в базі будуть втрачені!
echo.
set /p "confirm=Ви впевнені, що хочете продовжити? (Y/N): "
if /i not "%confirm%"=="Y" (
    echo Скасовано користувачем.
    pause
    exit /b
)

echo.
echo Розпочинаємо процес скидання бази даних...
echo ----------------------------------------

:: Активуємо віртуальне середовище
echo Активуємо віртуальне середовище...
call venv\Scripts\activate.bat
IF %ERRORLEVEL% NEQ 0 (
    echo ПОМИЛКА: Не вдалося активувати віртуальне середовище.
    echo Переконайтеся, що воно існує в папці 'venv'.
    pause
    exit /b
)
echo Віртуальне середовище активовано.
echo.

:: Видаляємо стару базу даних та файли міграцій
IF EXIST db.sqlite3 (
    echo Видалення існуючої бази даних (db.sqlite3)...
    del /f db.sqlite3
    echo Файл db.sqlite3 видалено.
) ELSE (
    echo Файл бази даних db.sqlite3 не знайдено, видалення не потрібне.
)
echo.

IF EXIST shop\migrations\0*.py (
    echo Видалення файлів міграцій з папки shop\migrations...
    del /f shop\migrations\0*.py
    echo Старі файли міграцій видалено.
) ELSE (
    echo Файли міграцій (0*.py) у shop\migrations не знайдено, видалення не потрібне.
)
echo Створення нового файлу __init__.py в shop\migrations (якщо потрібно)...
IF NOT EXIST shop\migrations\__init__.py (
    type nul > shop\migrations\__init__.py
    echo Файл __init__.py створено.
) ELSE (
    REM Опціонально: можна додати перевірку і очистку __init__.py, якщо він містить щось крім пустоти,
    REM але зазвичай type nul > ... перезаписує його коректно.
    echo Файл __init__.py вже існує.
)
echo.

:: Створюємо нові міграції та застосовуємо їх
echo Створення нових міграцій для додатку 'shop'...
python manage.py makemigrations shop
IF %ERRORLEVEL% NEQ 0 (
    echo ПОМИЛКА: Не вдалося створити міграції. Перевірте помилки вище.
    pause
    exit /b
)
echo Міграції створено.
echo.

echo Застосування міграцій до бази даних...
python manage.py migrate
IF %ERRORLEVEL% NEQ 0 (
    echo ПОМИЛКА: Не вдалося застосувати міграції. Перевірте помилки вище.
    pause
    exit /b
)
echo Міграції застосовано.
echo.

:: Створюємо суперкористувача
echo Створення суперкористувача (адміністратора сайту)...
echo ----------------------------------------------------
echo УВАГА: Зараз вам потрібно буде ввести дані для суперкористувача.
echo Це ім'я користувача, email (необов'язково) та пароль.
echo Пароль не буде відображатися при вводі з міркувань безпеки.
echo Будьте уважні та запам'ятайте введені дані!
echo.
python manage.py createsuperuser
IF %ERRORLEVEL% NEQ 0 (
    echo ПОМИЛКА або скасування створення суперкористувача.
    echo Якщо ви пропустили цей крок, ви можете створити суперкористувача пізніше командою:
    echo python manage.py createsuperuser
) ELSE (
    echo Суперкористувача успішно створено (або процес запущено).
)
echo.

echo ==========================================================
echo         НАЛАШТУВАННЯ БАЗИ ДАНИХ ЗАВЕРШЕНО!
echo ==========================================================
echo.
echo * Структуру бази даних створено.
echo * Суперкористувача створено (або запропоновано створити).
echo.
echo   ВАЖЛИВО:
echo   Для повноцінної роботи сайту вам потрібно буде
echo   додати контент (наприклад, товари в асортименті)
echo   через адміністративну панель Django.
echo   Адмін-панель зазвичай доступна за адресою: http://127.0.0.1:8000/admin/
echo.
echo ----------------------------------------
pause